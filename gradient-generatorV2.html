<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>渐变生成器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#7B61FF',
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .gradient-picker {
                height: 2.5rem;
                width: 2.5rem;
                padding: 0;
                border: none;
                cursor: pointer;
                overflow: hidden;
                border-radius: 4px;
            }
            .gradient-picker::-webkit-color-swatch-wrapper {
                padding: 0;
            }
            .gradient-picker::-webkit-color-swatch {
                border: none;
            }
            .custom-scrollbar::-webkit-scrollbar {
                width: 4px;
                height: 4px;
            }
            .custom-scrollbar::-webkit-scrollbar-thumb {
                background-color: rgba(156, 163, 175, 0.5);
                border-radius: 2px;
            }
            .preset-angle-btn.active {
                background-color: rgba(22, 93, 255, 0.1);
                color: #165DFF;
                border-color: #165DFF;
            }
            .modal-backdrop {
                backdrop-filter: blur(2px);
            }
            .presets-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 1rem;
            }
            .preset-card {
                display: flex;
                flex-direction: column;
                height: 100%;
            }
            .preset-card .gradient-preview {
                flex-grow: 1;
                min-height: 80px;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto p-4 md:p-6">
        <h1 class="text-2xl md:text-3xl font-bold mb-6 text-gray-800">渐变生成器</h1>
        
        <!-- 左右布局容器 -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- 左侧：数据设置区域 -->
            <div class="lg:col-span-7 space-y-6">
                <!-- 颜色设置区域 -->
                <div class="bg-white p-5 rounded-lg shadow-md">
                    <div class="flex flex-wrap items-center justify-between gap-2 mb-4">
                        <h2 class="text-lg font-semibold text-gray-800 flex items-center">
                            <i class="fa fa-palette text-primary mr-2"></i>颜色设置
                        </h2>
                        <div class="flex gap-2">
                            <button id="reverse-colors" class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded transition-colors flex items-center">
                                <i class="fa fa-exchange mr-1"></i>颜色和位置倒序
                            </button>
                            <button id="reverse-colors-keep-positions" class="px-3 py-1 text-sm bg-primary/10 hover:bg-primary/20 text-primary rounded transition-colors flex items-center">
                                <i class="fa fa-retweet mr-1"></i>仅颜色倒序
                            </button>
                        </div>
                    </div>
                    
                    <div id="color-container" class="space-y-5">
                        <!-- 颜色项示例 -->
                        <div class="color-item">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm text-gray-600">颜色 #1</span>
                                <span class="text-sm font-medium position-value">0%</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <input type="color" value="#3D4E81" class="gradient-picker">
                                <input type="text" value="#3D4E81" class="flex-1 p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50 color-input">
                                <div class="w-full max-w-xs">
                                    <input type="range" min="0" max="100" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary position-slider">
                                </div>
                                <button class="remove-color text-gray-400 hover:text-red-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i class="fa fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <button id="add-color" class="mt-4 px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded transition-colors flex items-center">
                        <i class="fa fa-plus mr-2"></i>添加颜色
                    </button>
                </div>
                
                <!-- 渐变参数设置区域 -->
                <div class="bg-white p-5 rounded-lg shadow-md">
                    <h2 class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
                        <i class="fa fa-sliders text-primary mr-2"></i>渐变参数
                    </h2>
                    
                    <div class="space-y-5">
                        <!-- 渐变类型选择 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">渐变类型</label>
                            <select id="gradient-type" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50">
                                <option value="linear">线性渐变 (linear)</option>
                                <option value="radial">径向渐变 (radial)</option>
                            </select>
                        </div>
                        
                        <!-- 角度/形状控制 -->
                        <div id="angle-control" class="space-y-4">
                            <div class="flex flex-wrap items-center justify-between gap-2">
                                <label class="block text-sm font-medium text-gray-700">角度</label>
                                <div class="flex items-center gap-3">
                                    <span class="text-sm font-medium angle-value">-225deg</span>
                                    
                                    <!-- 预设角度按钮组 -->
                                    <div class="flex items-center gap-1" id="angle-presets">
                                        <button type="button" class="preset-angle-btn bg-gray-100 hover:bg-gray-200 text-gray-700 rounded px-2 py-0.5 text-xs transition-colors border border-transparent" data-angle="0deg" title="垂直（从上到下）">
                                            <i class="fa fa-angle-down"></i>
                                        </button>
                                        <button type="button" class="preset-angle-btn bg-gray-100 hover:bg-gray-200 text-gray-700 rounded px-2 py-0.5 text-xs transition-colors border border-transparent" data-angle="180deg" title="垂直（从下到上）">
                                            <i class="fa fa-angle-up"></i>
                                        </button>
                                        <button type="button" class="preset-angle-btn bg-gray-100 hover:bg-gray-200 text-gray-700 rounded px-2 py-0.5 text-xs transition-colors border border-transparent" data-angle="90deg" title="水平（从左到右）">
                                            <i class="fa fa-angle-right"></i>
                                        </button>
                                        <button type="button" class="preset-angle-btn bg-gray-100 hover:bg-gray-200 text-gray-700 rounded px-2 py-0.5 text-xs transition-colors border border-transparent" data-angle="270deg" title="水平（从右到左）">
                                            <i class="fa fa-angle-left"></i>
                                        </button>
                                        <button type="button" class="preset-angle-btn bg-gray-100 hover:bg-gray-200 text-gray-700 rounded px-2 py-0.5 text-xs transition-colors border border-transparent" data-angle="45deg" title="斜向（左上到右下）">
                                            <i class="fa fa-angle-double-right"></i>
                                        </button>
                                        <button type="button" class="preset-angle-btn bg-gray-100 hover:bg-gray-200 text-gray-700 rounded px-2 py-0.5 text-xs transition-colors border border-transparent" data-angle="135deg" title="斜向（左下到右上）">
                                            <i class="fa fa-angle-double-left"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <input type="range" min="-360" max="360" value="-225" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary angle-slider">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>-360°</span>
                                <span>0°</span>
                                <span>360°</span>
                            </div>
                        </div>
                        
                        <!-- 径向渐变额外参数 -->
                        <div id="radial-controls" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">形状和大小</label>
                            <select id="radial-shape" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50">
                                <option value="circle">圆形 (circle)</option>
                                <option value="ellipse">椭圆形 (ellipse)</option>
                                <option value="circle closest-side">圆形（最近边）</option>
                                <option value="circle farthest-side">圆形（最远边）</option>
                                <option value="circle closest-corner">圆形（最近角）</option>
                                <option value="circle farthest-corner">圆形（最远角）</option>
                            </select>
                        </div>
                        
                        <!-- 渐变方案按钮 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">渐变方案</label>
                            <button id="open-presets-modal" class="w-full px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded transition-colors flex items-center justify-center">
                                <i class="fa fa-th-large mr-2"></i>选择预设渐变方案
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 右侧：预览和输出区域 -->
            <div class="lg:col-span-5 space-y-6">
                <!-- 图片预览区域 -->
                <div class="bg-white p-5 rounded-lg shadow-md">
                    <h2 class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
                        <i class="fa fa-image text-primary mr-2"></i>图片预览
                    </h2>
                    
                    <div class="w-full max-w-md mx-auto border border-gray-200 rounded-lg overflow-hidden bg-gray-100 mb-6">
                        <canvas id="image-preview" class="w-full h-auto"></canvas>
                    </div>
                    
                    <!-- 预览尺寸控制 -->
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">图片尺寸</label>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <div class="flex items-center justify-between mb-1">
                                    <span class="text-xs text-gray-500">宽度</span>
                                    <span class="text-xs font-medium width-value">300px</span>
                                </div>
                                <input type="range" min="10" max="600" value="300" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary width-slider">
                                <div class="flex gap-2 mt-1">
                                    <input type="number" min="10" max="600" value="300" class="w-full text-sm p-1 border border-gray-300 rounded width-input">
                                </div>
                            </div>
                            <div>
                                <div class="flex items-center justify-between mb-1">
                                    <span class="text-xs text-gray-500">高度</span>
                                    <span class="text-xs font-medium height-value">300px</span>
                                </div>
                                <input type="range" min="10" max="600" value="300" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary height-slider">
                                <div class="flex gap-2 mt-1">
                                    <input type="number" min="10" max="600" value="300" class="w-full text-sm p-1 border border-gray-300 rounded height-input">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- CSS输出区域 -->
                <div class="bg-white p-5 rounded-lg shadow-md">
                    <h2 class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
                        <i class="fa fa-code text-primary mr-2"></i>CSS代码
                    </h2>
                    <div class="relative">
                        <pre id="css-output" class="p-4 bg-gray-50 rounded border border-gray-200 text-sm overflow-x-auto max-h-40">linear-gradient(-225deg, #3D4E81 0%, #5753C9 48%, #6E7FF3 100%);</pre>
                        <button id="copy-css" class="absolute top-2 right-2 px-3 py-1 bg-secondary hover:bg-secondary/90 text-white text-xs rounded transition-colors flex items-center">
                            <i class="fa fa-copy mr-1"></i>复制
                        </button>
                    </div>
                    
                    <!-- 下载按钮 -->
                    <button id="download-image" class="mt-4 w-full py-2 bg-primary hover:bg-primary/90 text-white rounded transition-colors flex items-center justify-center">
                        <i class="fa fa-download mr-2"></i>下载渐变图片
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 渐变方案选择弹窗 -->
    <div id="presets-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black/50 modal-backdrop"></div>
        <div class="relative bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] flex flex-col">
            <div class="p-5 border-b border-gray-200 flex items-center justify-between">
                <h3 class="text-xl font-semibold text-gray-800">选择渐变方案</h3>
                <button id="close-presets-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <div id="presets-container" class="p-5 flex-1 overflow-y-auto custom-scrollbar">
                <div class="presets-grid">
                    <!-- 方案将动态加载 -->
                    <div class="text-center py-10 text-gray-500">
                        <i class="fa fa-circle-o-notch fa-spin text-2xl mb-2"></i>
                        <p>加载渐变方案中...</p>
                    </div>
                </div>
            </div>
            <div class="p-5 border-t border-gray-200 flex justify-end">
                <button id="cancel-presets" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded transition-colors">
                    取消
                </button>
            </div>
        </div>
    </div>

    <!-- 引入外部渐变方案数据 -->
    <script src="gradient-presetsV2.js"></script>
    
    <script>
        // 全局配置
        const gradientConfig = {
            type: "linear",
            angle: "-225deg",
            radialShape: "circle",
            width: 300,
            height: 300,
            colors: ["#3D4E81", "#5753C9", "#6E7FF3"],
            positions: ["0%", "48%", "100%"]
        };
        
        // DOM元素
        const colorContainer = document.getElementById('color-container');
        const addColorBtn = document.getElementById('add-color');
        const reverseColorsBtn = document.getElementById('reverse-colors');
        const reverseColorsKeepPositionsBtn = document.getElementById('reverse-colors-keep-positions');
        const gradientTypeSelect = document.getElementById('gradient-type');
        const angleSlider = document.querySelector('.angle-slider');
        const angleValue = document.querySelector('.angle-value');
        const anglePresets = document.getElementById('angle-presets');
        const radialControls = document.getElementById('radial-controls');
        const radialShapeSelect = document.getElementById('radial-shape');
        const imagePreview = document.getElementById('image-preview');
        const cssOutput = document.getElementById('css-output');
        const copyCssBtn = document.getElementById('copy-css');
        const downloadImageBtn = document.getElementById('download-image');
        const presetsContainer = document.getElementById('presets-container');
        const widthSlider = document.querySelector('.width-slider');
        const heightSlider = document.querySelector('.height-slider');
        const widthInput = document.querySelector('.width-input');
        const heightInput = document.querySelector('.height-input');
        const widthValue = document.querySelector('.width-value');
        const heightValue = document.querySelector('.height-value');
        const presetsModal = document.getElementById('presets-modal');
        const openPresetsModalBtn = document.getElementById('open-presets-modal');
        const closePresetsModalBtn = document.getElementById('close-presets-modal');
        const cancelPresetsBtn = document.getElementById('cancel-presets');
        
        // 初始化
        function init() {
            // 确保颜色和位置数组长度一致
            if (gradientConfig.colors.length !== gradientConfig.positions.length) {
                gradientConfig.positions = gradientConfig.colors.map((_, i) => 
                    i === 0 ? "0%" : i === gradientConfig.colors.length - 1 ? "100%" : `${Math.round(100/(gradientConfig.colors.length-1)*i)}%`
                );
            }
            
            renderColorItems();
            loadPresets();
            updateAnglePresetButtons();
            bindEvents();
            updateImagePreview();
            updateCssOutput();
        }
        
        // 渲染颜色项
        function renderColorItems() {
            colorContainer.innerHTML = '';
            gradientConfig.colors.forEach((color, index) => {
                const position = parseInt(gradientConfig.positions[index]) || 0;
                const colorItem = document.createElement('div');
                colorItem.className = 'color-item';
                colorItem.innerHTML = `
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-sm text-gray-600">颜色 #${index + 1}</span>
                        <span class="text-sm font-medium position-value">${position}%</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <input type="color" value="${color}" class="gradient-picker">
                        <input type="text" value="${color}" class="flex-1 p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50 color-input">
                        <div class="w-full max-w-xs">
                            <input type="range" min="0" max="100" value="${position}" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary position-slider">
                        </div>
                        <button class="remove-color text-gray-400 hover:text-red-500 transition-colors ${gradientConfig.colors.length <= 2 ? 'opacity-50 cursor-not-allowed' : ''}">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                `;
                colorContainer.appendChild(colorItem);
            });
        }
        
        // 加载渐变方案到弹窗
        function loadPresets() {
            if (typeof gradientPresets === 'undefined') {
                presetsContainer.innerHTML = '<div class="text-center py-6 text-gray-500">未找到渐变方案数据</div>';
                return;
            }
            
            presetsContainer.innerHTML = '<div class="presets-grid"></div>';
            const gridContainer = presetsContainer.querySelector('.presets-grid');
            
            gradientPresets.forEach((preset) => {
                // 处理老格式数据，补充默认值
                const compatiblePreset = {
                    name: preset.name || '未命名渐变',
                    direction: preset.direction || 'linear',
                    angle: preset.angle || (preset.deg ? `${preset.deg}deg` : '0deg'),
                    colors: preset.colors || [],
                    positions: preset.positions || []
                };
                
                // 如果是老格式且没有positions，自动生成位置
                if (compatiblePreset.colors.length > 0 && compatiblePreset.positions.length === 0) {
                    compatiblePreset.positions = compatiblePreset.colors.map((_, i) => {
                        if (compatiblePreset.colors.length === 1) return "0%";
                        return `${Math.round(100/(compatiblePreset.colors.length-1)*i)}%`;
                    });
                }
                
                // 生成渐变样式
                let gradientStyle = '';
                if (compatiblePreset.direction === 'linear') {
                    gradientStyle = `linear-gradient(${compatiblePreset.angle}, `;
                } else {
                    gradientStyle = `radial-gradient(${compatiblePreset.angle || 'circle'}, `;
                }
                
                const colorWithPositions = compatiblePreset.colors.map((color, i) => {
                    return `${color} ${compatiblePreset.positions[i] || '0%'}`;
                }).join(', ');
                
                gradientStyle += `${colorWithPositions})`;
                
                const card = document.createElement('div');
                card.className = 'preset-card cursor-pointer rounded overflow-hidden border border-gray-200 hover:border-primary transition-all transform hover:scale-105';
                card.innerHTML = `
                    <div class="gradient-preview" style="background: ${gradientStyle}"></div>
                    <div class="p-2 text-center text-xs truncate">${compatiblePreset.name}</div>
                `;
                
                card.addEventListener('click', () => {
                    applyPreset(compatiblePreset);
                    closePresetsModal();
                });
                gridContainer.appendChild(card);
            });
        }
        
        // 应用选中的渐变方案
        function applyPreset(preset) {
            // 处理可能的老格式数据，补充默认值
            gradientConfig.type = preset.direction || 'linear';
            gradientConfig.angle = preset.angle || '0deg';
            gradientConfig.colors = [...(preset.colors || [])];
            gradientConfig.positions = [...(preset.positions || [])];
            
            // 如果没有位置信息，自动生成
            if (gradientConfig.colors.length > 0 && gradientConfig.positions.length === 0) {
                gradientConfig.positions = gradientConfig.colors.map((_, i) => {
                    if (gradientConfig.colors.length === 1) return "0%";
                    return `${Math.round(100/(gradientConfig.colors.length-1)*i)}%`;
                });
            }
            
            gradientTypeSelect.value = gradientConfig.type;
            angleSlider.value = parseInt(gradientConfig.angle) || 0;
            angleValue.textContent = gradientConfig.angle;
            
            // 处理径向/线性渐变显示
            if (gradientConfig.type === 'radial') {
                radialControls.classList.remove('hidden');
                anglePresets.classList.add('hidden');
                if (gradientConfig.angle.includes('circle') || gradientConfig.angle.includes('ellipse')) {
                    radialShapeSelect.value = gradientConfig.angle;
                }
            } else {
                radialControls.classList.add('hidden');
                anglePresets.classList.remove('hidden');
            }
            
            updateAnglePresetButtons();
            renderColorItems();
            updateImagePreview();
            updateCssOutput();
        }
        
        // 更新角度预设按钮状态
        function updateAnglePresetButtons() {
            const buttons = document.querySelectorAll('.preset-angle-btn');
            buttons.forEach(btn => {
                if (btn.dataset.angle === gradientConfig.angle) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }
        
        // 更新CSS输出
        function updateCssOutput() {
            const colorWithPositions = gradientConfig.colors.map((color, i) => {
                return `${color} ${gradientConfig.positions[i] || ''}`;
            }).join(', ');
            
            let css;
            if (gradientConfig.type === 'linear') {
                css = `linear-gradient(${gradientConfig.angle}, ${colorWithPositions});`;
            } else {
                css = `radial-gradient(${gradientConfig.angle || gradientConfig.radialShape}, ${colorWithPositions});`;
            }
            
            cssOutput.textContent = css;
        }
        
        // 更新图片预览
        function updateImagePreview() {
            imagePreview.width = gradientConfig.width;
            imagePreview.height = gradientConfig.height;
            const ctx = imagePreview.getContext('2d');
            
            ctx.clearRect(0, 0, imagePreview.width, imagePreview.height);
            
            let gradient;
            if (gradientConfig.type === 'linear') {
                const angle = (parseInt(gradientConfig.angle) || 0) * Math.PI / 180;
                const x1 = imagePreview.width / 2;
                const y1 = imagePreview.height / 2;
                const length = Math.sqrt(imagePreview.width * imagePreview.width + imagePreview.height * imagePreview.height) / 2;
                const x2 = x1 + Math.cos(angle) * length;
                const y2 = y1 + Math.sin(angle) * length;
                
                gradient = ctx.createLinearGradient(x1, y1, x2, y2);
            } else {
                gradient = ctx.createRadialGradient(
                    imagePreview.width / 2, imagePreview.height / 2, 0,
                    imagePreview.width / 2, imagePreview.height / 2, Math.max(imagePreview.width, imagePreview.height) / 2
                );
            }
            
            gradientConfig.colors.forEach((color, i) => {
                const position = parseInt(gradientConfig.positions[i]) / 100 || (i / (gradientConfig.colors.length - 1));
                gradient.addColorStop(position, color);
            });
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, imagePreview.width, imagePreview.height);
        }
        
        // 下载渐变图片
        function downloadGradientImage() {
            try {
                imagePreview.toBlob(blob => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'gradient-background.png';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    const originalText = downloadImageBtn.innerHTML;
                    downloadImageBtn.innerHTML = '<i class="fa fa-check mr-2"></i>下载成功';
                    setTimeout(() => {
                        downloadImageBtn.innerHTML = originalText;
                    }, 2000);
                });
            } catch (error) {
                console.error('下载失败:', error);
                alert('下载失败，请重试');
            }
        }
        
        // 颜色和位置都倒序
        function reverseColorsAndPositions() {
            // 完全反转颜色数组
            gradientConfig.colors = [...gradientConfig.colors].reverse();
            
            // 反转位置数组并调整百分比（0%变成100%，100%变成0%）
            gradientConfig.positions = gradientConfig.positions
                .map(pos => `${100 - parseInt(pos)}%`)
                .reverse();
            
            renderColorItems();
            updateImagePreview();
            updateCssOutput();
        }
        
        // 仅颜色倒序，保持位置不变
        function reverseColorsKeepPositions() {
            // 只反转颜色数组，位置保持不变
            gradientConfig.colors = [...gradientConfig.colors].reverse();
            
            renderColorItems();
            updateImagePreview();
            updateCssOutput();
        }
        
        // 打开渐变方案弹窗
        function openPresetsModal() {
            presetsModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        // 关闭渐变方案弹窗
        function closePresetsModal() {
            presetsModal.classList.add('hidden');
            document.body.style.overflow = '';
        }
        
        // 绑定事件
        function bindEvents() {
            // 添加颜色
            addColorBtn.addEventListener('click', () => {
                const randomColor = '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
                
                let newPosition = 100;
                if (gradientConfig.positions.length > 0) {
                    const lastPos = parseInt(gradientConfig.positions[gradientConfig.positions.length - 1]) || 100;
                    newPosition = Math.max(0, Math.min(100, lastPos - 10));
                }
                
                gradientConfig.colors.push(randomColor);
                gradientConfig.positions.push(`${newPosition}%`);
                renderColorItems();
                updateImagePreview();
                updateCssOutput();
            });
            
            // 颜色和位置都倒序
            reverseColorsBtn.addEventListener('click', reverseColorsAndPositions);
            
            // 仅颜色倒序，保持位置不变
            reverseColorsKeepPositionsBtn.addEventListener('click', reverseColorsKeepPositions);
            
            // 颜色容器事件委托
            colorContainer.addEventListener('input', (e) => {
                const colorItems = document.querySelectorAll('.color-item');
                const index = Array.from(colorItems).indexOf(e.target.closest('.color-item'));
                
                if (index === -1) return;
                
                if (e.target.classList.contains('gradient-picker')) {
                    gradientConfig.colors[index] = e.target.value;
                    colorItems[index].querySelector('.color-input').value = e.target.value;
                }
                
                if (e.target.classList.contains('color-input')) {
                    if (/^#([0-9A-F]{3}){1,2}$/i.test(e.target.value)) {
                        gradientConfig.colors[index] = e.target.value;
                        colorItems[index].querySelector('.gradient-picker').value = e.target.value;
                    }
                }
                
                if (e.target.classList.contains('position-slider')) {
                    const value = e.target.value;
                    gradientConfig.positions[index] = `${value}%`;
                    colorItems[index].querySelector('.position-value').textContent = `${value}%`;
                    updateImagePreview();
                    updateCssOutput();
                }
            });
            
            // 移除颜色
            colorContainer.addEventListener('click', (e) => {
                if (e.target.closest('.remove-color') && gradientConfig.colors.length > 2) {
                    const colorItems = document.querySelectorAll('.color-item');
                    const index = Array.from(colorItems).indexOf(e.target.closest('.color-item'));
                    
                    gradientConfig.colors.splice(index, 1);
                    gradientConfig.positions.splice(index, 1);
                    renderColorItems();
                    updateImagePreview();
                    updateCssOutput();
                }
            });
            
            // 渐变类型变更
            gradientTypeSelect.addEventListener('change', (e) => {
                gradientConfig.type = e.target.value;
                
                if (e.target.value === 'radial') {
                    radialControls.classList.remove('hidden');
                    anglePresets.classList.add('hidden');
                    gradientConfig.angle = gradientConfig.radialShape;
                    angleValue.textContent = gradientConfig.radialShape;
                } else {
                    radialControls.classList.add('hidden');
                    anglePresets.classList.remove('hidden');
                    gradientConfig.angle = `${angleSlider.value}deg`;
                    angleValue.textContent = `${angleSlider.value}deg`;
                }
                
                updateImagePreview();
                updateCssOutput();
            });
            
            // 径向形状变更
            radialShapeSelect.addEventListener('change', (e) => {
                gradientConfig.radialShape = e.target.value;
                gradientConfig.angle = e.target.value;
                angleValue.textContent = e.target.value;
                updateImagePreview();
                updateCssOutput();
            });
            
            // 角度滑块变更
            angleSlider.addEventListener('input', (e) => {
                const value = e.target.value;
                gradientConfig.angle = `${value}deg`;
                angleValue.textContent = `${value}deg`;
                updateAnglePresetButtons();
                updateImagePreview();
                updateCssOutput();
            });
            
            // 角度预设按钮点击
            anglePresets.addEventListener('click', (e) => {
                const btn = e.target.closest('.preset-angle-btn');
                if (btn) {
                    const angle = btn.dataset.angle;
                    gradientConfig.angle = angle;
                    angleSlider.value = parseInt(angle);
                    angleValue.textContent = angle;
                    updateAnglePresetButtons();
                    updateImagePreview();
                    updateCssOutput();
                }
            });
            
            // 宽度滑块变更
            widthSlider.addEventListener('input', (e) => {
                const value = parseInt(e.target.value);
                gradientConfig.width = value;
                widthValue.textContent = `${value}px`;
                widthInput.value = value;
                updateImagePreview();
            });
            
            // 宽度输入框变更
            widthInput.addEventListener('input', (e) => {
                let value = parseInt(e.target.value) || 10;
                value = Math.min(600, Math.max(10, value));
                gradientConfig.width = value;
                widthValue.textContent = `${value}px`;
                widthSlider.value = value;
                updateImagePreview();
            });
            
            // 高度滑块变更
            heightSlider.addEventListener('input', (e) => {
                const value = parseInt(e.target.value);
                gradientConfig.height = value;
                heightValue.textContent = `${value}px`;
                heightInput.value = value;
                updateImagePreview();
            });
            
            // 高度输入框变更
            heightInput.addEventListener('input', (e) => {
                let value = parseInt(e.target.value) || 10;
                value = Math.min(600, Math.max(10, value));
                gradientConfig.height = value;
                heightValue.textContent = `${value}px`;
                heightSlider.value = value;
                updateImagePreview();
            });
            
            // 复制CSS
            copyCssBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(cssOutput.textContent)
                    .then(() => {
                        const originalText = copyCssBtn.innerHTML;
                        copyCssBtn.innerHTML = '<i class="fa fa-check mr-1"></i>已复制';
                        setTimeout(() => {
                            copyCssBtn.innerHTML = originalText;
                        }, 2000);
                    })
                    .catch(() => alert('复制失败，请手动复制'));
            });
            
            // 下载图片
            downloadImageBtn.addEventListener('click', downloadGradientImage);
            
            // 渐变方案弹窗控制
            openPresetsModalBtn.addEventListener('click', openPresetsModal);
            closePresetsModalBtn.addEventListener('click', closePresetsModal);
            cancelPresetsBtn.addEventListener('click', closePresetsModal);
            
            // 点击弹窗背景关闭
            presetsModal.addEventListener('click', (e) => {
                if (e.target === presetsModal) {
                    closePresetsModal();
                }
            });
            
            // 按ESC键关闭弹窗
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !presetsModal.classList.contains('hidden')) {
                    closePresetsModal();
                }
            });
        }
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
    