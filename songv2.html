<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title id="titleMessage">木子才演唱会</title>
    <style>
        /* 样式保留原有逻辑，新增列表分割线样式 */
        body {
            padding: 0;
            margin: 0;
            display: flex;
            height: 100vh;
            flex-direction: column;
            justify-content: center;
            align-items: center;

            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation; /* 防止双击缩放 */
        }
        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        button, select {
            padding: 8px 8px;
            cursor: pointer;
            margin: 0 5px; /* 增加一点间距 */
            border: none;
            border-radius: 4px;
        }
        .bgColor {
            background-color: #fcfcfc;
        }
        .textColor {
            color: #333333;
            text-align: center;
        }
        .div2 button {
            border: 1px solid #333333;
        }
        .buttonContentLoad {
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
        }
        .buttonContent {
            top: 0;
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: auto;
            padding: 10px; /* 列表内边距 */
        }
        /* 新增：列表项样式 + 分割线 */
        .buttonContent button {
            margin: 2px 0; /* 上下间距 */
            padding: 10px 15px; /* 内边距增大，更易点击 */
            border-bottom: 1px solid #939292; /* 底部分割线 */
            border-radius: 0; /* 取消圆角，让分割线更连贯 */
            background-color: #f8f8f8; /* 列表项背景色 */
            text-align: center; /* 居中对齐 */
        }
        /* 列表项hover效果，提升交互体验 */
        .buttonContent button:hover {
            background-color: #f0f0f0;
        }
        .div1 {
            height: auto;
            margin: 20px 0;
        }
        .div2 {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            height: auto;
            flex-wrap: wrap; /* 允许按钮换行 */
            gap: 5px;
            padding: 10px;
        }
        .songInfo {
            margin-bottom: 10px;
            padding: 0;
            margin: 0;
            margin-top: 8px;
        }
        select {
            border: 1px solid #ccc;
        }
    </style>
</head>
<body onclick="bodyAction()" class="bgColor">
    <div class="container">
        <p id="songInfo"  class="textColor songInfo" >木子才演唱会</p>

        <div class="div1">
            <h3 id="title"  class="textColor" ></h3>
            <audio id="player" onended="handleEnded()" controls>
                Your browser does not support the audio element.
            </audio>
        </div>

        <div class="div2">
            <button class="textColor" onclick="handlePreviousTrack()">上一首</button>
            <button class="textColor" id="playOrPauseButton">播放</button>
            <button class="textColor" onclick="handleNextTrack()">下一首</button>
            <button class="textColor" id="loopButton" onclick="handleLoop()">模式全部</button>
            <button class="textColor" onclick="playRandomTrack()">抽歌</button>
            <button class="textColor" id="listButton" onclick="listShowOrHidden()">列表隐藏</button>
            <!-- 下拉框不再手动写option，由JS自动生成 -->
            <select class="textColor" id="sourceSelect" onchange="switchDataSource()"></select>
        </div>
        <div class="buttonContentLoad" id="songList" style="display: none;">
            <div class="buttonContent" id="buttonContent"></div>
        </div>
    </div>

    <!-- 引入数据源（新增数据源只需添加对应的script标签） -->
    <script src="https://yococoxc.github.io/tool/data/sunodata2.js"></script>
    <script src="https://yococoxc.github.io/tool/data/sunodata2025.js"></script>
    <script src="https://yococoxc.github.io/tool/data/sunodata2025AllRank.js"></script>
    <!-- 示例：新增数据源只需添加这行 + 配置数组项
    <script src="https://yococoxc.github.io/tool/data/sunodata2024.js"></script>
    -->
    <script type="text/javascript">
        // ========== 核心配置：数据源列表（第一个为默认播放） ==========
        const dataSourceConfig = [
            { key: 'tracks2025AllRank', name: '2025年全部歌曲排名' },
            { key: 'tracks', name: '全部歌曲' }, // 第一个 = 默认播放
            { key: 'tracks2025', name: '2025年演唱会' },
            // 示例：新增数据源只需添加这一行即可，下拉框会自动生成选项
            // { key: 'tracks2024', name: '2024年演唱会' },
            // { key: 'tracks2023', name: '2023年演唱会' },
        ];

        // 全局状态 - 改为读取第一个配置项作为默认
        const defaultDataSource = dataSourceConfig[0]; // 取第一个配置项为默认
        let currentTracks = window[defaultDataSource.key]; // 默认加载第一个数据源
        let currentDataSourceKey = defaultDataSource.key; // 默认选中第一个数据源key
        let loopValue = 0;
        let isFrist = true;
        let isPlaying = false;
        var player = document.getElementById('player');
        var currentTitle = null;
        var currentIndex = 0;
        var currentUrl = null;

        // ========== 数据源切换核心函数 ==========
        function switchDataSource() {
            // 获取下拉框选中的数据源key
            const selectEl = document.getElementById('sourceSelect');
            currentDataSourceKey = selectEl.value;
            
            // 根据key获取对应的数据源（window[key] 可以获取全局变量）
            currentTracks = window[currentDataSourceKey];
            
            // 校验数据源是否存在
            if (!currentTracks || !Array.isArray(currentTracks)) {
                alert(`数据源${currentDataSourceKey}加载失败，请检查脚本是否引入`);
                // 回退到第一个可用数据源
                currentDataSourceKey = dataSourceConfig[0].key;
                currentTracks = window[currentDataSourceKey];
                selectEl.value = currentDataSourceKey;
            }

            // 重置播放状态
            currentIndex = 0;
            player.pause();
            
            // 更新UI和列表
            initSongList();
            playNextTrack();
            
            // 更新页面标题相关信息
            const currentSourceName = dataSourceConfig.find(item => item.key === currentDataSourceKey)?.name || '全部歌曲';
            document.getElementById('titleMessage').innerHTML = `木子才${currentSourceName} 《${currentTitle || ''}》`;
        }

        // ========== 原有功能逻辑（完全保留，无修改） ==========
        function handleLoop() {
            loopValue++;
            if (loopValue >= 4) {
                loopValue = 0;
            }

            if (loopValue == 0) {
                document.getElementById('loopButton').innerHTML = '模式全部';
            } else if (loopValue == 1) {
                document.getElementById('loopButton').innerHTML = '模式歌组';
            } else if (loopValue == 2) {
                document.getElementById('loopButton').innerHTML = '模式单曲';
            } else if (loopValue == 3) {
                document.getElementById('loopButton').innerHTML = '模式随机';
            }
        }

        function listShowOrHidden() {
            var list = document.getElementById('songList');
            if (list.style.display == 'none') {
                list.style.display = 'flex';
                document.getElementById('listButton').innerHTML = '列表隐藏';
            } else {
                list.style.display = 'none';
                document.getElementById('listButton').innerHTML = '列表显示';
            }
        }

        function trackButtonAction(e) {
            let index = e.target.getAttribute('data-index');
            let array = currentTracks[index].array;
            if (array.length == 0) {
                e.stopPropagation();
                return;
            }

            currentIndex = index;
            playNextTrack();
            e.stopPropagation();
        }

        player.addEventListener('play', function () {
            isPlaying = true;
            document.getElementById('playOrPauseButton').innerHTML = '暂停';
        });

        player.addEventListener('pause', function () {
            isPlaying = false;
            document.getElementById('playOrPauseButton').innerHTML = '播放';
        });

        function initSongList() {
            var buttonContent = document.getElementById('buttonContent');
            buttonContent.innerHTML = '';
            let sumTrackNum = 0;
            
            const currentSourceName = dataSourceConfig.find(item => item.key === currentDataSourceKey)?.name || '全部歌曲';
            
            for (var i = 0; i < currentTracks.length; i++) {
                let tempTrack = currentTracks[i];

                var button = document.createElement('button');
                button.innerHTML = i + 1 + '. ' + tempTrack.title + ' (' +  tempTrack.array.length + ')';
                button.className = "textColor";
                button.setAttribute('data-index', i);
                button.onclick = trackButtonAction;
                buttonContent.appendChild(button);

                sumTrackNum += tempTrack.array.length;
            }

            requestAnimationFrame(() => {
                buttonContent.scrollTop = 0;
            });

            document.getElementById('songInfo').innerHTML = `木子才${currentSourceName}，共 ${sumTrackNum} 首`;
        }

        function playRandomTrack() {
            currentIndex = Math.floor(Math.random() * currentTracks.length);
            let array = currentTracks[currentIndex].array;
            if (array.length == 0) {
                playRandomTrack();
                return;
            }

            playNextTrack();
        }

        function playNextTrack() {
            if (isFrist) {
                document.getElementById('playOrPauseButton').innerHTML = '播放';
            } else {
                document.getElementById('playOrPauseButton').innerHTML = '暂停';
            }
            
            isFrist = false;

            let array = currentTracks[currentIndex].array;
            if (array == undefined || array.length == 0) {
                return;
            }

            var newIndex = Math.floor(Math.random() * array.length);
            let tempTrack = array[newIndex];

            currentTitle = tempTrack.name2;
            currentUrl = tempTrack.mp3;

            player.src = currentUrl;
            player.play();
            isPlaying = true;

            const currentSourceName = dataSourceConfig.find(item => item.key === currentDataSourceKey)?.name || '全部歌曲';
            document.getElementById('titleMessage').innerHTML = `木子才${currentSourceName} 《${currentTitle}》`;
            document.getElementById('title').innerHTML = currentTitle;
        }

        function handlePreviousTrack() {
            if (loopValue == 3) {
                playRandomTrack();
                return;
            }
            currentIndex = parseInt(currentIndex) - 1;
            if (currentIndex < 0) {
                currentIndex = currentTracks.length - 1;
            }

            let array = currentTracks[currentIndex].array;
            if (array.length == 0) {
                handlePreviousTrack();
                return;
            }

            playNextTrack();
        }
        
        function handleNextTrack() {
            if (loopValue == 3) {
                playRandomTrack();
                return;
            }
            currentIndex = parseInt(currentIndex) + 1;
            if (currentIndex >= currentTracks.length) {
                currentIndex = 0;
            }

            let array = currentTracks[currentIndex].array;
            if (array.length == 0) {
                handleNextTrack();
                return;
            }

            playNextTrack();
        }
        
        function handleEnded() {
            if (loopValue == 3) {
                playRandomTrack();
                return;
            }
            if (loopValue == 1) {
                playNextTrack();
                return;
            }
            if (loopValue == 2) {
                player.src = currentUrl;
                player.play();
                isPlaying = true;
                return;
            }

            currentIndex = parseInt(currentIndex) + 1;
            if (currentIndex >= currentTracks.length) {
                currentIndex = 0;
            }

            let array = currentTracks[currentIndex].array;
            if (array.length == 0) {
                handleEnded();
                return;
            }

            playNextTrack();
        }

        document.getElementById('playOrPauseButton').addEventListener('click', function() {
            isFrist = false;

            if (isPlaying) {
                player.pause();
                isPlaying = false;
                document.getElementById('playOrPauseButton').innerHTML = '播放';
            } else {
                if (!player.src || player.ended) {
                    playNextTrack();
                } else {
                    player.play();
                    isPlaying = true;
                }
                document.getElementById('playOrPauseButton').innerHTML = '暂停';
            }
        });

        function bodyAction() {
            if (isFrist == false) {
                return;
            }
            isFrist = false;

            player.play();
            isPlaying = true;
            document.getElementById('playOrPauseButton').innerHTML = '暂停';
        }

        // ========== 页面初始化（核心改动：默认选中第一个数据源 + 列表分割线） ==========
        document.addEventListener('DOMContentLoaded', () => {
            // 1. 自动生成下拉框选项（根据dataSourceConfig）
            const selectEl = document.getElementById('sourceSelect');
            selectEl.innerHTML = ''; // 清空原有选项
            dataSourceConfig.forEach(item => {
                const option = document.createElement('option');
                option.value = item.key; // 绑定数据源key
                option.textContent = item.name; // 显示友好名称
                // 关键：默认选中第一个配置项
                if (item.key === defaultDataSource.key) {
                    option.selected = true;
                }
                selectEl.appendChild(option); // 添加到下拉框
            });

            // 2. 初始化歌曲列表
            initSongList();
            // 3. 自动播放（默认播放第一个数据源的内容）
            playNextTrack();
            isFrist = true;
        });
    </script>
</body>
</html>
